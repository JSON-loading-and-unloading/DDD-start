# 01 도메인 모델 시작하기

## 1.1 도메인이란?

- 도메인은 구현해야 할 소프트웨어의 대상이 된다.
- 한 도메인은 다시 하위 도메인으로 나눌 수 있다.
    - EX) 온라인 서점 도메인의 하위 도메인 : 주문, 결제 등등..
    - 하위 도메인을 어떻게 구성할지 여부는 상황에 따라 달라진다.

## 1.2 도메인 전문가와 개발자 간 지식 공유

- 요구사항을 제대로 이해하지 않으면 쓸모없거나 유용함이 떨어지는 시스템을 만들기 때문에 코딩에 앞서 요구사항을 올바르게 이해하는 것이 중요하다.
- 개발자 또한 도메인 전문가 만큼은 아니겠지만 도메인 지식을 갖춰야 한다.

## 1.3 도메인 모델

- 도메안 모델을 사용하면 여러 관계자들이 동일한 모습으로 도메인을 이해하고 도메인 지식을 공유하는 데 도움이 된다.
- 도메인을 이해하려면 도메인이 제공하는 기능과 도메인의 주요 데이터 구성을 파악해야 하는데, 이런 면에서 기능과 데이터를 함께 보여주는 객체 모델은 도메인을 모델링하기에 적합하다.
- 객체 모델만을 사용해야 하는 것은 아니다. 도메인을 이해하는 데 도움이 된다면 표현 방식이 무엇인지는 중요하지 않다.
- 도메인은 다수의 하위 도메인으로 구성된다. 각 하위 도메인이 다루는 영역은 서로 다르기 때문에 같은 용어라도 하위 도메인마다 의미가 달라질 수 있다.
    - 도메인에 따라 용어 의미가 결정되므로 여러 하위 도메인을 하나의 다이어그램에 모델링하면 안 된다.
    - 모델의 각 구성요소는 특정 도메인으로 한정할 때 비로소 의미가 완전해지기 때문에 각 하위 도메인마다 별도로 모델을 만들어야 한다.

## 1.4 도메인 모델 패턴

- 일반적인 애플리케이션의 아키텍처는 네 개의 영역으로 구성된다.

| 영역 | 설명 |
| --- | --- |
| 사용자 인터페이스(UI) 또는 표현(Presentation) | 사용자의 요청을 처리하고 사용자에게 정보를 보여준다. 여기서 사용자는 소프트웨어를 사용하는 사람뿐만 아니라 외부 시스템일 수도 있다.  |
| 응용 (Application) | 사용자가 요청한 기능을 실행한다. 업무 로직을 직접 구현하지 않으며 도메인 게층을 조합해서 기능을 실행한다. |
| 도메인 | 시스템이 제공할 도메인 규칙을 구현한다. |
| 인프라스트럭쳐(infrastructure) | 데이터베이스나 메시징 시스템과 같은 외부 시스템과의 연동을 처리한다.  |
- 도메인 계층은 도메인의 핵심 규칙을 구현한다. 이런 도메인 규칙을 객체 지향 기법으로 구현하는 패턴이 도메인 모델 패턴이다.
- 핵심 규칙을 구현한 코드는 도메인 모델에만 위치하기 때문에 규칙이 바뀌거나 규칙을 확장해야 할 때 다른 코드에 영향을 덜 주고 변경 내역을 모델에 반영할 수 있게 된다.

## 1.5 도메인 모델 도출

- 도메인을 모델링할 때 기본이 되는 작업은 모델을 구성하는 핵심 구성요소, 규칙, 기능을 찾는 것이다. 이 과정은 요구사항에서 출발한다.

## 1.6 엔티티와 밸류

- 도출한 모델은 크게 엔티티, 밸류로 구분할 수 있다.
- 엔티티와 밸류를 제대로 구분해야 도메인을 올바르게 설계하고 구현할 수 있기 때문에 이 둘의 차이를 명확하게 이해하는 것은 도메인을 구현하는 데 있어 중요하다.

### 1.6.1 엔티티

- 엔티티의 가장 큰 특징은 식별자를 가진다는 것이다. 식별자는 엔티티 객체마다 고유해서 각 엔티티는 서로 다른 식별자를 갖는다.
- 엔티티를 생성하고 속성을 바꾸고 삭제할 때까지 식별자는 유지된다.
- 엔티티의 식별자는 바뀌지 않고 고유하기 때문에 두 엔티티 객체의 식별자가 같으면 두 엔티티는 같다고 판단할 수 있다.

### 1.6.2 엔티티의 식별자 생성

- 엔티티의 식별자를 생성하는 시점은 도메인의 특징과 사용하는 기술에 따라 달라진다.
    - 특정 규칙에 따라 생성
    - UUID나 Nano ID와 같은 고유 식별자 생성기 사용
    - 값을 직접 입력
    - 일련번호 사용(시퀀스나 DB의 자동 증가 칼럼 사용)

### 1.6.3 밸류 타입

- 밸류 타입은 개념적으로 완전한 하나를 표현할 때 사용한다.
- 밸류 타입은 도메인 개념을 포함한다. 밸류 타입을 사용함으로써 개념적으로 완전한 하나를 잘 표현할 수 있다.
- 밸류 타입은 밸류 타입을 위한 기능을 추가할 수 있다는 장점이 있다.
- 밸류 객체의 데이터를 변경할 때는 기존 데이터를 변경하기보다는 변경한 데이터를 갖는 새로운 밸류 객체를 생성하는 방식, 즉 불변으로 구현하는 것을 선호한다.
- 불변 객체는 참조 투명성과 스레드에 안전한 특징을 가지고 있다.

### 1.6.4 엔티티 식별자와 밸류 타입

- 엔티티 식별자의 실제 데이터는 String과 같은 문자열로 구성된 경우가 많다. 이때, 밸류 타입을 사용하면 해당 필드가 무엇을 나타내는지 쉽게 알 수 있다.

### 1.6.5 도메인 모델에 set 메서드 넣지 않기

- 도메인 모델에 get/set 메서드를 무조건 추가하는 것은 좋지 않은 버릇이다. 특히 set 메서드는 도메인의 핵심 개념이나 의도를 코드에서 사라지게 한다.
- 습관적으로 작성한 set 메서드는 필드값만 변경하고 끝나기 때문에 상태 변경과 관련된 도메인 지식이 코드에서 사라지게 된다. (값 변경에 대해 명시적이지 않다!)
- set 메서드의 또 다른 문제는 도메인 객체를 생성할 때 온전하지 않는 상태가 될 수 있다.
    - 도메인 객체가 불완전한 상태로 사용되는 것을 막으려면 생성 시점에 필요한 것을 전달해 주어야 한다. 즉, 생성자를 통해 필요한 데이터를 모두 받아야 한다.

## 1.7 도메인 용어와 유비쿼터스 언어

- 코드를 작성할 때 도메인에서 사용하는 용어는 매우 중요하다. 도메인에서 사용하는 용어를 코드에 반영하지 않으면 그 코드는 개발자에게 코드의 의미를 해석해야 하는 부담을 준다.
- 유비쿼터스 언어
    - 전문가, 관계자, 개발자가 대화, 문서, 도메인 모델, 코드, 테스트 등 모든 곳에서 사용하는 도메인과 관련된 공통의 언어
    - 소통 과정에서 발생하는 용어의 모호함을 줄일 수 있고 개발자는 도메인과 코드 사이에서 불필요한 해석 과정을 줄일 수 있다.